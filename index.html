<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no, email=no, address=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta property="og:title" content="青岚宗秘境 - 修仙道途抉择">
    <meta property="og:description" content="双秘术抉择，仙魔殊途，唯1好结局+1隐藏结局待你解锁！">
    <meta property="og:image" content="https://picsum.photos/id/1048/800/450">
    <meta property="og:type" content="game">
    <title>青岚宗秘境 · 三生道途抉择</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            min-height: 100vh;
            padding: 0;
            font-family: "微软雅黑", "PingFang SC", "Helvetica Neue", sans-serif;
            background: url('https://picsum.photos/id/1031/1920/1080') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            color: #2c3e50;
            -webkit-font-smoothing: antialiased;
            transition: background 0.8s ease-in-out;
        }
        body.bg-tianmo {
            background: url('https://picsum.photos/id/1043/1920/1080') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
        }
        body.bg-xinghe {
            background: url('https://picsum.photos/id/1023/1920/1080') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
        }
        body.bg-changsheng {
            background: url('https://picsum.photos/id/1036/1920/1080') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
        }
        .music-player {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            width: 120px;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
        }
        .status-bar {
            height: constant(safe-area-inset-top);
            height: env(safe-area-inset-top);
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
        }
        .container {
            width: 100%;
            min-height: calc(100vh - constant(safe-area-inset-top));
            min-height: calc(100vh - env(safe-area-inset-top));
            padding: 20px 15px;
            background: #ffffff;
            margin-top: 5px;
            border-radius: 12px 12px 0 0;
        }
        h2 {
            text-align: center;
            font-size: 24px;
            margin: 10px 0 20px;
            padding: 0 10px;
            color: #2c3e50;
            font-weight: 600;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .option {
            padding: 18px 20px;
            margin: 15px 0;
            background: #ecf0f1;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            line-height: 1.6;
            border: none;
            width: 100%;
            text-align: left;
        }
        .option:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(52, 152, 219, 0.3);
        }
        .back-btn, .reset-btn {
            padding: 12px 25px;
            margin: 20px 5px 10px;
            border: none;
            border-radius: 8px;
            background: #e74c3c;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease;
            display: inline-block;
        }
        .back-btn:hover, .reset-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }
        .plot-text {
            line-height: 2.2;
            margin: 15px 0;
            padding: 15px 18px;
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 6px;
            font-size: 15px;
            color: #2c3e50;
            text-align: justify;
        }
        /* 隐藏结局专属文本样式 */
        .hidden-ending {
            color: #9b59b6;
            font-weight: 600;
            text-decoration: underline;
        }
        .countdown-tip {
            color: #e74c3c;
            text-align: center;
            font-weight: 600;
            margin: 20px 0;
            display: none;
            font-size: 16px;
            padding: 12px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
        }
        h3 {
            color: #34495e;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
            font-weight: 600;
        }
        .skill-btn {
            background: #f5f0ff;
            border: 2px solid #9b59b6;
            font-weight: 600;
            color: #9b59b6;
        }
        .skill-btn:hover {
            background: #9b59b6;
            color: white;
            border-color: #9b59b6;
        }
        @media (max-width: 375px) {
            .container {
                padding: 15px 10px;
            }
            .option {
                padding: 15px 18px;
                font-size: 15px;
            }
            h2 {
                font-size: 22px;
            }
            h3 {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="music-player">
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height="100%" 
        src="https://music.163.com/outchain/player?type=2&id=1861403382&auto=1&height=32"
        sandbox="allow-scripts allow-same-origin allow-popups" 
        allow="autoplay; music-playback">
        </iframe>
    </div>

    <div class="status-bar"></div>
    <div class="container">
        <h2>青岚宗秘境 · 三生道途抉择</h2>

        <div class="step active" id="step1">
            <h3>第一步：叩问本心，择无上根法</h3>
            <div class="plot-text">
                你是青岚宗外门弟子，因误入后山「锁灵渊」，失足坠入万丈崖底，竟撞开尘封三千年的上古秘境。
                秘境穹顶悬着三道流光，化作三本古朴古籍：<br>
                一本嵌满碎星，星力呼啸欲裂；一本萦绕淡金霞光，寿元气息沁人心脾；一本裹着浓浓血雾，魔威直冲神魂。
                崖底传来苍老低语：「三法择一，道途既定，仙魔殊途，唯1好结局+1隐藏结局待你解锁，其余皆为身死道消...」
            </div>
            <div class="option" data-root="星河令" data-bg="bg-xinghe">星河令 - 御星算天，引星辰之力铸不灭道基</div>
            <div class="option" data-root="长生诀" data-bg="bg-changsheng">长生诀 - 炼体延寿，聚天地灵气筑不朽肉身</div>
            <div class="option" data-root="天魔策" data-bg="bg-tianmo">天魔策 - 噬血噬魂，吞万灵精魄成魔道至尊</div>
        </div>

        <div class="step" id="step2">
            <h3>第二步：法随心动，择分支精修</h3>
            <div class="plot-text" id="plot2"></div>
            <div id="flow-options"></div>
            <button class="back-btn" onclick="showStep('step1')">返回重择根法</button>
        </div>

        <div class="step" id="step3">
            <h3>第三步：凝心悟道，择核心秘术</h3>
            <div class="plot-text" id="plot3">选定流派后，丹田内浮现两道秘术灵光，皆为该流派无上绝学，择其一精修，道途截然不同！唯有特定抉择可解锁好结局与隐藏结局。</div>
            <div id="skill-option"></div>
            <button class="back-btn" onclick="showStep('step2')">返回重择流派</button>
        </div>

        <div class="step" id="step4">
            <h3>第四步：生死关头，决命运走向</h3>
            <div class="plot-text" id="plot4"></div>
            <div id="choice-options"></div>
            <div class="countdown-tip" id="countdown">抉择已定，3秒后揭晓最终道途...</div>
            <button class="back-btn" onclick="showStep('step3')">返回重选秘术</button>
        </div>

        <div class="step" id="step5">
            <h3>终局：道途既定，看万古荣光</h3>
            <div class="plot-text" id="plot5"></div>
            <button class="reset-btn" onclick="resetAll()">重踏仙途，再寻机缘</button>
        </div>
    </div>

    <script>
        // 负面结局随机池（每个根法共用，避免重复）
        const badEndings = [
            "你道心不坚，在抉择中迷失方向，神魂被天地规则碾碎，身死道消，万古不留名",
            "功法反噬，经脉寸断，修为尽散，最终沦为凡夫俗子，在病痛中孤独终老",
            "贪心不足，强行催动秘术，引动天劫降临，肉身被天雷劈成飞灰，魂飞魄散",
            "被心魔入侵，神智错乱，屠戮生灵，最终被正道修士围剿，形神俱灭",
            "秘术修炼失败，丹田破碎，沦为废人，在宗门底层受尽屈辱，郁郁而终",
            "误触秘境禁制，被上古杀阵绞杀，连残魂都未能留下，彻底湮灭于天地间"
        ];

        // 核心剧情数据（优化后触发路径）
        const immortalData = {
            星河令: {
                // 好结局：逆势破局（星算流→逆天改命诀→舍己为人）- 贴合星算"窥天机、救苍生"特性
                // 隐藏结局：星界独行（御星流→星陨七杀诀→坚守杀伐道）- 贴合御星"杀伐为道"却不盲从规则
                branches: [
                    {
                        flow:"御星流", 
                        plot2:"你指尖触碰到《星河令》，刹那间漫天星屑涌入丹田，识海浮现亿万星辰图谱。古籍化作一道星虹，在你经脉中流转，所过之处窍穴尽通。守陵长老虚影浮现：「御星者，可引星力攻伐，亦可借星轨推演，你选哪条路？」",
                        skills: [
                            {
                                name:"星辰御天诀", 
                                realm:"星辰皇", 
                                plot4:"你引星力灌体，境界突破至星辰皇，周身七星环缭绕，威压震慑秘境。忽然，秘境穹顶裂开星门，上古星神残魂走出：「吾乃星界之主，奉吾为主，赐你星军兵权；若抗，神魂化星屑，永世不得超生！」",
                                choices:["俯首叩拜，奉星神为主，愿掌星界兵权", "拔剑怒喝，反抗星神威压，誓守自身道心"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（盲从权威）
                                    getRandomBadEnding()  // 负面结局（逆势却道心不足）
                                ]
                            },
                            {
                                name:"星陨七杀诀", 
                                realm:"星陨帝", 
                                plot4:"你以陨星力炼体，境界突破至星陨帝，手中陨星杀剑引动漫天陨石，天地色变。星界执法者踏星而来，手持星罚之链：「你杀伐过重，违逆星界规则，要么自废修为受罚，要么以力抗罚，血战星界！」",
                                choices:["自废三成修为，接受星罚，暂避杀劫", "执陨星杀剑，血战星界执法者，誓不低头"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（妥协退让）
                                    "<span class='hidden-ending'>你以杀伐道硬撼星界规则，虽未颠覆星界，却杀出一条独行之路，解锁「星界独行」隐藏结局，不属星神管辖，逍遥于星辰缝隙，战力万古无双</span>" // 隐藏结局
                                ]
                            }
                        ]
                    },
                    {
                        flow:"星算流", 
                        plot2:"《星河令》融入你眉心，识海化作一片星图，每一颗星辰都对应着一人一界的命运。你闭眼推演，竟能看到宗门弟子的生老病死。守陵长老虚影轻叹：「星算者，可窥天机，亦可改命，你敢踏这逆天之路吗？」",
                        skills: [
                            {
                                name:"逆天改命诀", 
                                realm:"改命皇", 
                                plot4:"你掐诀推演，一口鲜血喷在星盘上，三千年后邪魔降世的浩劫清晰浮现。眉心星印发烫，寿元飞速流逝，守陵长老低语：「要么耗寿元推破劫之法，要么封星盘隐世，任天地倾覆。」",
                                choices:["燃尽千年寿元，推演破劫之法，救亿万苍生", "封印命运星盘，隐世不出，只求自身逍遥"],
                                ends: [
                                    "你以千年寿元换破劫之策，九州生灵存续，你虽寿元耗尽，却被天地认可，凝聚星辰道果，成「星算圣人」，万古敬仰（好结局）", // 好结局
                                    getRandomBadEnding()  // 负面结局（自私避世）
                                ]
                            },
                            {
                                name:"星轨推演术", 
                                realm:"星算帝", 
                                plot4:"你以星轨推演自身道途，竟看到自己三日后将遭雷劫劈身，魂飞魄散。唯一的生路：要么借星盘遮蔽天机，隐于世俗避劫；要么引雷劫入体，以星力炼魂，逆天改命。",
                                choices:["遮蔽天机，隐于世俗市井，暂避雷劫", "引雷劫入体，以星力炼魂，赌一场逆天机缘"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（逃避劫数）
                                    getRandomBadEnding()  // 负面结局（赌性过重，魂体俱灭）
                                ]
                            }
                        ]
                    }
                ]
            },
            长生诀: {
                // 好结局：守正出奇（固本流→金刚不坏身→保留七情）- 贴合长生"炼体不炼心"，坚守人性
                // 隐藏结局：自然共生（延寿流→千寿延年经→顺天应命）- 贴合延寿"顺天地、合自然"，不逆天硬抗
                branches: [
                    {
                        flow:"固本流", 
                        plot2:"《长生诀》化作一道金光，钻入你的四肢百骸，你能清晰感受到，每一寸肌肉都在变强，每一滴血液都在焕发活力。守陵长老虚影抚须笑道：「固本者，炼体为先，九转涅槃后，肉身可堪比仙器，你可愿受这涅槃之苦？」",
                        skills: [
                            {
                                name:"九转固元功", 
                                realm:"固元圣境", 
                                plot4:"你踏入丹火池准备第九转涅槃，丹火灼烧肉身时，神魂如风中残烛。守陵长老声音响起：「要么压制丹火温养神魂百年，要么强行冲关，赌不死金身机缘。」",
                                choices:["压制丹火，温养神魂百年，待稳固后再涅槃", "引动全部丹火，强行冲关，誓修不死金身"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（急于求成反遭反噬）
                                    getRandomBadEnding()  // 负面结局（温养过久，错失机缘）
                                ]
                            },
                            {
                                name:"金刚不坏身", 
                                realm:"金刚帝", 
                                plot4:"你炼就金刚不坏身，肉身硬抗三次天劫而无伤，却发现自己的七情六欲正在逐渐消散，即将成为无心的长生傀儡。唯一选择：要么自废一成肉身，解封神魂；要么彻底封魂，成无心长生之躯。",
                                choices:["自废一成肉身，解封神魂，保留七情六欲", "彻底封魂，成无心之躯，享永恒长生"],
                                ends: [
                                    "你解封神魂，虽失一成肉身，却保留七情六欲，以「有情之躯修无情炼体」，成金刚帝，逍遥天地间，寿元五千年，被称为「人间活仙」（好结局）", // 好结局
                                    getRandomBadEnding()  // 负面结局（无心则无魂，沦为躯壳）
                                ]
                            }
                        ]
                    },
                    {
                        flow:"延寿流", 
                        plot2:"《长生诀》融入你的丹田，化作一枚寿元果，你的寿元瞬间暴涨至千年。你站在镜前，竟发现鬓角的白发悄然变黑。守陵长老虚影叹道：「延寿者，可享千年岁月，却也会引来天劫觊觎，你敢逆天增寿吗？」",
                        skills: [
                            {
                                name:"千寿延年经", 
                                realm:"千寿真君", 
                                plot4:"你寿元累积至八千年，天际雷云汇聚，紫金雷龙俯冲而下。守陵长老低语：「要么散去千年寿元化解天劫，要么催动寿元硬抗，破天道桎梏。」",
                                choices:["散去千年寿元，化解天劫，安享八百年逍遥", "催动八千年寿元，硬撼雷龙，誓破天道桎梏"],
                                ends: [
                                    "<span class='hidden-ending'>你顺天应命散去千年寿元，却因心境圆满被天地馈赠「自然寿元」，解锁「自然共生」隐藏结局，寿元随天地流转，无天劫困扰，逍遥世间万载</span>", // 隐藏结局
                                    getRandomBadEnding()  // 负面结局（硬抗天道，魂飞魄散）
                                ]
                            },
                            {
                                name:"天地养寿诀", 
                                realm:"养寿帝", 
                                plot4:"你借昆仑山脉灵气养寿，寿元达万年，却看到昆仑山脉三日后将因仙魔大战崩塌，你也会寿元尽散而亡。唯一选择：要么斩断灵根，另寻山川；要么以身护山，与昆仑共存亡。",
                                choices:["斩断天地灵根，舍弃万年寿元，另寻山川养寿", "以身护山，催动寿元抵挡仙魔大战，与昆仑共存亡"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（斩断灵根，寿元骤减而亡）
                                    getRandomBadEnding()  // 负面结局（护山失败，同归于尽）
                                ]
                            }
                        ]
                    }
                ]
            },
            天魔策: {
                // 好结局：魔心守正（噬魂流→噬魂夺舍诀→不贪仙帝躯）- 贴合魔道"夺舍却不嗜杀"的反差感
                // 隐藏结局：血河守界（血魔流→血河炼魔身→融合却不迷失）- 贴合血魔"控血河却掌本心"的高阶玩法
                branches: [
                    {
                        flow:"血魔流", 
                        plot2:"《天魔策》化作一道血雾，钻入你的喉咙，一股嗜血的欲望在心底滋生。你低头看去，双手竟覆盖上一层血色鳞甲，指尖利爪闪烁着寒光。守陵长老虚影的声音带着寒意：「血魔者，以血为食，以杀为道，你可愿堕入魔道？」",
                        skills: [
                            {
                                name:"万血噬魔功", 
                                realm:"血魔帝", 
                                plot4:"你站在仙魔结界前，怀中藏着圣兽精血，却远不及仙帝精血。仙界结界大开，仙帝瑶池设宴，夺血易如反掌，却会引来仙界诸神围剿。",
                                choices:["撕裂结界，潜入瑶池，弑帝夺取仙帝精血", "放弃夺血，炼化圣兽精血，铸就不完美魔躯"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（弑帝遭围剿）
                                    getRandomBadEnding()  // 负面结局（魔躯有瑕，遭心魔反噬）
                                ]
                            },
                            {
                                name:"血河炼魔身", 
                                realm:"血河帝", 
                                plot4:"你引血河之水炼体，即将突破血河帝，却感受到血河之魂正在反噬自身，即将掌控你的意识。唯一选择：要么压制血河之魂，自废一成魔功；要么融合血河之魂，成血河之主。",
                                choices:["压制血河之魂，自废一成魔功，保留自身意识", "融合血河之魂，成血河之主，掌魔界血河之力"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（自废魔功，沦为魔道底层）
                                    "<span class='hidden-ending'>你以强大魔心融合血河之魂却不迷失，解锁「血河守界」隐藏结局，掌魔界血河之力，却以血河为界隔绝魔祸，成魔道罕见的「守界魔帝」，仙魔两界皆不敢犯</span>" // 隐藏结局
                                ]
                            }
                        ]
                    },
                    {
                        flow:"噬魂流", 
                        plot2:"《天魔策》钻入你的识海，无数魔物的魂魄在你脑海中嘶吼。你心念一动，便能吞噬身边的游魂，魂力暴涨。守陵长老虚影冷笑道：「噬魂者，可夺舍他人肉身，永生不死，你敢做这逆天之事吗？」",
                        skills: [
                            {
                                name:"噬魂夺舍诀", 
                                realm:"噬魂魔皇", 
                                plot4:"你修成噬魂魔皇，魔躯却因征战受损，时日无多。恰逢昊天仙帝渡劫濒死、九幽魔主重伤垂危，两者皆是完美肉身，夺舍其一便可重生。",
                                choices:["趁虚而入，夺舍昊天仙帝残躯，仙魔同体称霸", "潜入魔宫，夺舍九幽魔主肉身，威慑九天仙庭"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（夺舍仙帝遭仙神追杀）
                                    "你放弃称霸之念，夺舍九幽魔主肉身却不嗜杀，以魔威震慑魔道乱党，护一方魔界安宁，成「魔心守正」的魔道至尊，万古传颂（好结局）" // 好结局
                                ]
                            },
                            {
                                name:"万魂融神诀", 
                                realm:"万魂帝", 
                                plot4:"你融合九千九百九十九道神魂，即将铸就万魂神体，却听到识海万魂嘶吼，自身意识正在逐渐迷失。唯一选择：要么舍弃千道神魂，稳固自身意识；要么融合最后一道神魂，成万魂帝，赌自身本心。",
                                choices:["舍弃千道神魂，稳固自身意识，暂缓突破", "融合最后一道神魂，成万魂帝，以本心压制万魂"],
                                ends: [
                                    getRandomBadEnding(), // 负面结局（舍弃过多，魂力大减而亡）
                                    getRandomBadEnding()  // 负面结局（融合失控，被万魂吞噬）
                                ]
                            }
                        ]
                    }
                ]
            }
        };

        let currentFlow = null;

        // 随机获取负面结局（避免重复）
        function getRandomBadEnding() {
            const randomIndex = Math.floor(Math.random() * badEndings.length);
            return badEndings[randomIndex];
        }

        function showStep(stepId) {
            document.querySelectorAll(".step").forEach(step => step.classList.remove("active"));
            document.getElementById(stepId).classList.add("active");
        }

        // 根功法选择 - 渲染流派
        document.querySelectorAll("[data-root]").forEach(btn => {
            btn.onclick = function() {
                const root = this.dataset.root;
                const bgClass = this.dataset.bg;
                document.body.className = bgClass;
                const flowBox = document.getElementById("flow-options");
                flowBox.innerHTML = "";
                immortalData[root].branches.forEach(flow => {
                    const div = document.createElement("div");
                    div.className = "option";
                    div.innerText = flow.flow;
                    div.onclick = () => {
                        currentFlow = flow;
                        document.getElementById("plot2").innerText = flow.plot2;
                        renderSkills();
                        showStep("step3");
                    };
                    flowBox.appendChild(div);
                });
                showStep("step2");
            };
        });

        // 渲染秘术选项
        function renderSkills() {
            const skillBox = document.getElementById("skill-option");
            skillBox.innerHTML = "";
            currentFlow.skills.forEach((skill, idx) => {
                const div = document.createElement("div");
                div.className = "option skill-btn";
                div.id = `skill-btn${idx+1}`;
                div.innerText = `${skill.name} - 修成可证${skill.realm}之位`;
                div.onclick = () => renderChoice(skill);
                skillBox.appendChild(div);
            });
        }

        // 渲染剧情抉择
        function renderChoice(skill) {
            document.getElementById("plot4").innerText = skill.plot4;
            const choiceBox = document.getElementById("choice-options");
            choiceBox.innerHTML = "";
            skill.choices.forEach((choice, idx) => {
                const div = document.createElement("div");
                div.className = "option";
                div.innerText = choice;
                div.onclick = () => showEnding(skill.ends[idx]);
                choiceBox.appendChild(div);
            });
            showStep("step4");
        }

        // 显示结局（支持HTML格式渲染隐藏结局样式）
        function showEnding(endText) {
            const countdown = document.getElementById("countdown");
            countdown.style.display = "block";
            setTimeout(() => countdown.innerHTML = "抉择已定，2秒后揭晓最终道途...", 1000);
            setTimeout(() => countdown.innerHTML = "抉择已定，1秒后揭晓最终道途...", 2000);
            setTimeout(() => {
                document.getElementById("plot5").innerHTML = endText; // 用innerHTML支持HTML样式
                showStep("step5");
                countdown.style.display = "none";
            }, 3000);
        }

        function resetAll() {
            document.body.className = "";
            currentFlow = null;
            showStep("step1");
        }
    </script>
</body>
</html>
